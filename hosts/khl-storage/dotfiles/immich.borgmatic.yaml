source_directories:
  - /home/kwalas/Data/services/immich # TODO magic number, get that from variable that is shared with dokploy

repositories: # TODO add offsite backup
  - path: /mnt/backup/services/kmac5-services-immich

encryption_passcommand: cat /home/kwalas/Secrets/borg-passphrase # TODO change to some keystore solution

commands:
  - before: configuration
    when:
      - create
    run: # TODO unhardcode magic numbers
      - docker stop immich_server
      - docker exec -t immich_postgres pg_dumpall --clean --if-exists --username=postgres | gzip > "/home/kwalas/Data/services/immich/dump.sql.gz"
  - after: configuration
    when:
      - create
    run:
      - echo "docker start"
      # - docker start immich_server

keep_daily: 7
keep_weekly: 4
keep_monthly: 6
