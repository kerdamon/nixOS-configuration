source_directories:
  - /home/kwalas/Data/services/immich # TODO magic number, get that from variable that is shared with dokploy

repositories: # TODO add offsite backup
  - path: /mnt/backup/services/kmac5-services-immich

encryption_passcommand: cat /home/kwalas/Secrets/borg-passphrase # TODO change to some keystore solution

commands:
  - before: configuration
    when:
      - create
    run: # TODO rework how vars are stored and passed
      - DOKPLOY_URL=$(cat ~/Config/backup/dokploy-url) DOKPLOY_API_KEY_PATH=~/Secrets/dokploy-api-key dokploy-stop-compose $(cat ~/Config/backup/immich-compose-id)
  - after: configuration
    when:
      - create
    run:
      - dokploy-start-compose immich

keep_daily: 7
keep_weekly: 4
keep_monthly: 6
